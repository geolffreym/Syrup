<!DOCTYPE html>
<html lang="en" sp-app="Hey">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script src="/syrup/dist/init.js"></script>


<div sp-recipe="Hey.You">

    <!-- The event -->
    <a href="#" sp-click="the_method">
        yes
    </a>

    <!-- The model -->
    <form action="" sp-submit="process_form">
        <input type="text" name="firstName" placeholder="Name" data-min="2"/> <br/>
        <input type="text" name="firstName" placeholder="Name" data-min="2"/> <br/>
        <input type="text" name="lastName" placeholder="Last Name" data-min="2"/><br/>
        <input type="text" name="phone" placeholder="Phone Number"/><br/>
        <input type="text" name="id" placeholder="Id" /><br/>
        <input type="submit" data-skip="true"/>
    </form>

    <!-- The view -->
    <div sp-view>

    </div>

    <!-- The Inline template -->
    <template sp-tpl>
        <div>
            <ul>
                {{#beatles}}
                <li>{{ firstName }} {{lastName}}</li>
                    {{#phone}}
                        <li>{{ phone }}</li>
                    {{/phone}}

                    {{#id}}
                        <li>{{ id }}</li>
                    {{/id}}
                {{/beatles}}
            </ul>

        </div>
    </template>
</div>


<div sp-recipe="Hey.Do">
    <!-- The method "method" in module Hey.Do-->
    <a href="#" sp-click="method">
        Change You
    </a>


</div>


<script>

    //The controller
    _$ (function () {

        //The App with dependencies
        var my_Lib = App.blend ('Hey', ['Http', 'Model']);

        //A global service
        my_Lib.service ('myConsole', function (msg) {
            console.log (msg)
        });

        //The modules, templates, events, view are encapsulated in recipes
        //Recipes are declared as sp-recipe and is associated with the recipe's name

        //A new recipe for Hey
        my_Lib.recipe ('Hey.You', function (_, _$, scope) {
            return {
                init        : function ($) {
                    var _self = this;


                    //$ has dependencies object
                    // $ = {Http: HttpObject}

                    //The context in template as scope
                    this.setScope ({
                        'beatles': [
                            { "firstName": "John", "lastName": "Lennon" },
                            { "firstName": "Paul", "lastName": "McCartney" },
                            { "firstName": "George", "lastName": "Harrison" },
                            { "firstName": "Ringo", "lastName": "Starr" }
                        ]
                    }).serve ();


                    //When Hey.You scope change
                    this.when ('change', function (changes) {

                        // Render new data using the inline template
                        // If not serve param is set, template inline is used
                        // If you set "Hey/You" "/app/view/Hey/You.js" view is used
                        // Lousing Coupling( The main dir -> "Hey" , The File -> "You", The view name -> "myView")
                        //_self.serve ('Hey/You/myView');
                        _self.serve ();

                        // The global service in tools
                        $.myConsole ('Done');
                    })
                },
                process_form: function (e, $) {
                    e.preventDefault ();
                    var _self = this;
                    //Pack the model, from source
                    $.Model.pack (e.target).then (function (model) {
                        console.log(model.getObject())
                        _self.setScope ({ 'beatles': [model.getObject ()] });
                        //Send to server
//                        model.send ('/miapp/myServerSideScript', model.getObject ())
//                                .then (function (result) {})
                    });


                },
                destroy     : function ($) {
                    alert ('destroyed?')
                }
            }
        });

        //A new recipe for Hey
        my_Lib.recipe ('Hey.Do', function (_, _$, scope) {
            return {
                init   : function (tools) {

                },
                method : function (e, $) {
                    my_Lib.setScope ('Hey.You', {
                        'beatles': [
                            { "firstName": "John", "lastName": "Pasa" }
                        ]
                    });

                },
                destroy: function () {}
            }
        });


    })

</script>
</body>
</html>
