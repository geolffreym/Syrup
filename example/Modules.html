<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<!-- If you have problems please change directories in /dist/init.js and writes concerning your application
<script src="/syrup/dist/init.js"></script>
//Basic Config

var setting = {
	app_path   : '/syrup/app',
	system_path: '/syrup/system',
	env        : 'development'
};

-->


<main sp-app></main>


<script>

    (function (App) {
        //Module
        App.module ('main', [
            'Router',
            'Hash'
            //Dependencies
        ]).cook (function ($) {
            //Conf Provider!!
            //Provide conf to Router
            //The route must match with the uri !IMPORTANT
            $.Router.connect (this).set ({
                'home'      : '/syrup/Modules.html',
                'categories': '/categories',
                'error404'  : '/404'

            }).then (function (route) {

                route.when ('home', {
                    tpl  : 'skull/index/home.html',
                    app  : 'index', //App blend name
                    cache: true

                }).when ('categories', {
                    tpl  : 'skull/index/home.html',
                    app  : 'categories',
                    cache: true

                }).otherwise ('error404', {
                    tpl  : 'skull/error/404.html',
                    app  : 'error404', //App blend name
                    cache: true
                })

            });

            //Handling Hash..
            $.Hash.when ('home').then (function (e) {
                $.redirect ('home', e);
            }).when ('categories').then (function (e) {
                $.redirect ('categories', e);
            })

        }).service ({
            //Redirect service
            'redirect': function (route, params) {
                this.Router.redirect (route, params);
            }
        });

    }) (App);


</script>

<script>

    //Index App
    (function (App) {
        //Encapsulate

        var _main = App.module ('main'),
                _indexApp = _main.blend ('index', ['Http']);

        //CSRF token !!
        _indexApp.cook (function ($) {

            //Intercept request!!
            $.Http.intercept ({
                'request': function (conf) {
                    if ( conf.method == 'POST' )
                        conf.headers['X-CSRFToken'] = _.getCookie ('csrftoken');
                }
            });

        }).recipe ('header', function (at, g) {
            //Index App
            //HEADER
            return {
                init: function ($) {
                    this.app.title ('Call me and Askme')
                            .view.render ('index/index/header.html');
                }
            }

        }).recipe ('middle', function (at, g) {
            //MIDDLE
            return {
                //Initialize recipe!!
                init: function ($) {
                    //Recipe object
                    var _self = this;

                    ////Request categories..
                    //$.Http.get ('/categories/', 'get_categories').then (function (r) {
                    _self.view.render ('index/index/main.html', true);
                    //});


                }
            }
        }).recipe ('footer', function (_, g) {
            //FOOTER
            return {
                init: function ($) {
                    this.view.render (
                            'index/index/footer.html', true
                    )
                }
            }
        })

    }) (App);


    //Categories
    (function (App) {
        var _main = App.module ('main'),
                _indexApp = _main.blend ('categories', ['Http']);


        //Route App
        _indexApp.recipe ('header', function (_, g) {
            return {
                init: function ($) {
                    this.app.title ('Categories')
                            .view.render ('index/categories/header.html');
                }
            }
        }).recipe ('middle', function (_, g) {
            return {
                init: function ($) {
                    var _self = this;

                    // $.Http.get ('/categories/').then (function (r) {
                    _self.scope.set ({ 'categories': [{ pk: 1, name: 'Test' }] })
                            .view.render ('index/categories/main.html');
                    // });
                }
            }
        }).recipe ('footer', function (_, g) {
            return {
                init: function ($) {
                    this.view.render (
                            'index/index/footer.html'
                    );
                }
            }
        })

    }) (App);


    //Error
    (function (App) {
        //Encapsulate
        App.module ('main').blend ('error404', []);

    }) (App);
</script>
</body>
</html>