(function(window){"use strict";function View(){this.Http=new Http;this.Repo=new Repo;this.tpl=null}View.add("lookup",function(template){this.Http.intercept({request:function(config){config.headers["Content-Type"]="text/plain"}});return this.Http.request(setting.app_path+"/templates/"+template)});View.add("seekTpl",function(template){var _self=this,_repo=_self.Repo,_template=null,_save={};if(!_.isSet(_repo.get("templates"))){_repo.set("templates",{})}_template=_repo.get("templates");return new Promise(function(resolve,reject){if(template in _template){_self.tpl=_template[template];resolve(_self)}else{_self.lookup(template).then(function(_tpl){_self.tpl=_save[template]=_tpl;_repo.append("templates",_save);resolve(_self)}).catch(function(){reject(template);_.error(_.WARNING_SYRUP.ERROR.NONETWORK,"(View .seekTpl)")})}})});View.add("getTpl",function(){return this.tpl});View.add("clear",function(){this.Repo.clear("templates");return this});View.add("cleanCache",function(template){var old_templates=this.Repo.get("templates");if(old_templates&&template in old_templates){delete old_templates[template]}this.Repo.set("templates",old_templates);return this});View.add("render",function(_template,_fields){var _self=this,_worker=new Workers;return new Promise(function(resolve,reject){_fields=_.isObject(_template)&&_template||_fields;_template=!_.isObject(_template)&&_.isString(_template)&&_template||_self.tpl;_worker.intercept({message:function(e){resolve(e.data)}}).run("/workers/setting/Parser").then(function(worker){worker.toWork({template:_template,fields:_fields})})})});window.View=View})(window);