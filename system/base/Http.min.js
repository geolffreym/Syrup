"use strict";(function(window){function Http(){this.xhr=null;this.upload=null;this.config={};this.name="default";this.interceptors={"default":{}}}Http.add("request",function(url,data){var _self=this,_query=_.emptyStr,_data=data||null;_self.xhr=new window.XMLHttpRequest||new window.ActiveXObject("Microsoft.XMLHTTP");_self.config=_.extend({method:"GET",timeout:4e3,upload:false,cors:false,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}},_self.config,true);_self._handleInterceptor("request",_self.config);return new Promise(function(resolve,reject){if(!_.isSet(url))_.error(_.WARNING_SYRUP.ERROR.NOURL,"(Http .request)");if(!_.isFormData(_data)&&_.isObject(_data)&&_.getObjectSize(_data)>0){_data=_.jsonToQueryString(_data)}if(_self.config.method==="GET"&&_.isString(_data)){_query+="?"+_data}_query=url+_query;_self.xhr.open(_self.config.method,_query,true);_self.xhr.timeout=_self.config.timeout;if(!_.isFormData(_data)){_.each(_self.config.headers,function(value,header){_self._requestHeader(header,value)})}_self.xhr.withCredentials=!!_self.config.cors;if(_.isSet(_self.config.upload)&&_.isBoolean(_self.config.upload)){_self.upload=_self.xhr.upload;_self.xhr=_self.upload}_self.xhr.addEventListener("load",function(e){if(this.status>=200&&this.status<400||this.status==0){this.responseClean=_self._response(this);_self._handleInterceptor("success",this);resolve(this.responseClean)}});_self.xhr.addEventListener("progress",function(e){_self._handleInterceptor("progress",e)});_self.xhr.addEventListener("readystatechange",function(e){if(this.readyState){_self._handleInterceptor("state",this)}});_self.xhr.addEventListener("abort",function(e){_self._handleInterceptor("abort",this)});_self.xhr.addEventListener("loadend",function(e){this.responseClean=_self._response(this);_self._handleInterceptor("complete",this)});_self.xhr.addEventListener("loadstart",function(e){_self._handleInterceptor("before",this)});_self.xhr.addEventListener("error",function(e){_self._handleInterceptor("error",this);reject(e)});_self.xhr.send(_self.config.method!=="GET"?_data:null)})});Http.add("intercept",function(named,interceptors,extend){var _self=this;extend=_.isArray(interceptors)&&interceptors||_.isArray(extend)&&extend||null;interceptors=_.isObject(named)&&named||_.isObject(interceptors)&&interceptors||{};named=!_.isObject(named)&&_.isString(named)&&named||_self.name;if(!(named in _self.interceptors))_self.interceptors[named]={};if(extend){MiddleWare.extend(_self.interceptors,named,extend)}if(_.isObject(interceptors))MiddleWare.intercept(_self.interceptors[named],interceptors);return this});Http.add("interceptClean",function(type,named){named=named||this.name;MiddleWare.cleanInterceptor(this.interceptors[named],type);return this});Http.add("_handleInterceptor",function(type,param){if(this.name in this.interceptors){MiddleWare.trigger(MiddleWare.getInterceptors(this.interceptors[this.name],type),[param,this])}});Http.add("get",function(url,data,naming){return this._rest(url,"GET",data,naming)});Http.add("post",function(url,data,naming){return this._rest(url,"POST",data,naming)});Http.add("put",function(url,data,naming){return this._rest(url,"PUT",data,naming)});Http.add("delete",function(url,data,naming){return this._rest(url,"DELETE",data,naming)});Http.add("abort",function(){this.xhr&&this.xhr.abort()});Http.add("_rest",function(url,type,data,naming){this.config.method=type;this.name=_.isString(data)&&data||naming||"default";return this.request(url,_.isObject(data)&&data||{})});Http.add("_response",function(xhr){var _response=xhr.response||xhr.responseText||xhr.responseXML;return _.isJson(_response)&&_.toObject(_response)||_response});Http.add("_requestHeader",function(header,type){this.xhr.setRequestHeader(header,type);return this});window.Http=Http})(window);