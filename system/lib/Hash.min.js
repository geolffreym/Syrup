(function(window){"use strict";function Hash(){this.interceptors={};this.onhashchange={};var _self=this;window.addEventListener("hashchange",function(e){_self._handleInterceptor("change",e);var _hash=_self._cleanHash(location.hash),_params=_self._getParams(location.hash);if(_hash in _self.onhashchange){_.each(_self.onhashchange[_hash],function(v){v(_params)},true)}})}Hash.add("when",function(hash){_.assert(hash,_.WARNING_SYRUP.ERROR.NOPARAM,"(Router .when)");var _self=this;if(!(hash in _self.onhashchange))_self.onhashchange[hash]=[];return{then:function(resolve){_self.onhashchange[hash].push(resolve);return _self}}});Hash.add("_cleanHash",function(hash){return _.replace(hash,"#",_.emptyStr).split("/")[0]});Hash.add("_getParams",function(hash){var _split=hash.split("/");_split=(_split.length>1&&_split||hash.split("?")).splice(1);return _.isString(hash)&&_split.length>0&&_.queryStringToJson(_split.pop())||{}});Hash.add("intercept",function(interceptors){if(_.isObject(interceptors))MiddleWare.intercept(this,interceptors);return this});Hash.add("_handleInterceptor",function(type,param){MiddleWare.trigger(MiddleWare.getInterceptors(this,type),[param,this]);MiddleWare.cleanInterceptor(this,type)});Hash.add("connect",function(to_route){if(!(to_route instanceof AppClass))_.error(WARNING_ROUTE.ERROR.BADINSTANCE,"(Router .route)");this.module=to_route;to_route.lazy=true;return this});window.Hash=Hash})(window);