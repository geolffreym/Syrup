(function(window){"use strict";function Hash(){this.interceptors={};this.onhashchange={};var _self=this;window.addEventListener("hashchange",function(e){var _hash=_self._cleanHash(location.hash),_params=_self._getParams(location.hash);_self._handleInterceptor("change",_params);if(_hash in _self.onhashchange){_.each(_self.onhashchange[_hash],function(v){v(_params)})}})}Hash.add("reset",function(hash){location.hash="#";return this});Hash.add("when",function(hash){_.assert(hash,_.WARNING_SYRUP.ERROR.NOPARAM,"(Router .when)");var _self=this;if(!(hash in _self.onhashchange))_self.onhashchange[hash]=[];return{then:function(resolve){_self.onhashchange[hash].push(resolve);return _self}}});Hash.add("_cleanHash",function(hash){var _hash=_.replace(hash,"#",_.emptyStr),_split=_hash.split("/");return(_split.length>1&&_split||_hash.split("?"))[0]});Hash.add("_getParams",function(hash){var _split=hash.split("/");_split=(_split.length>1&&_split||hash.split("?")).splice(1);return _split.length>0&&_.queryStringToJson(_split[0])||{}});Hash.add("intercept",function(interceptors){if(_.isObject(interceptors))MiddleWare.intercept(this,interceptors);return this});Hash.add("interceptClean",function(type){MiddleWare.cleanInterceptor(this,type);return this});Hash.add("_handleInterceptor",function(type,param){MiddleWare.trigger(MiddleWare.getInterceptors(this,type),[param,this])});window.Hash=Hash})(window);