"use strict";var WARNING_MODEL={ERROR:{NOPACK:"Error packing model"}};function Model(){this.Http=new Http;this.modelData=null;this.modelFiles=null;this.object={};this.type="POST";this.model=null;this.failed=null}Model.add("method",function(method){this.type=method.toUpperCase();return this});Model.add("attach",function(name,attach){var self=this;_.assert(self.modelData,WARNING_MODEL.ERROR.NOPACK,"(Model .attach)");self.modelData.append(name,attach);return this});Model.add("multiple",function(name){var _return=[],_model_obj=this.model.object();if(name in _model_obj.elements){_.each(_model_obj.elements[name],function(v,i){_return.push(v.value)})}return _return.length>0?_return:false});Model.add("fail",function(field,error){this.failed=true;return{field:field,error:error,coords:_.cartesianPlane(field)}});Model.add("send",function(url,data){var self=this;if(_.isObject(url)||_.isFormData(data)){data=url;url=null}if(!_.isSet(data)&&!_.isSet(self.modelData))_.error(WARNING_MODEL.ERROR.NOPACK,"(Model .send)");var conf={url:url||self.model.attr("action"),data:data||self.modelData||self.modelFiles,method:self.type};return new Promise(function(resolve,reject){if(self.failed)reject(data);self.Http.kill();self.Http.request(conf).then(function(response){resolve(response)}).catch(reject)})});Model.add("getObject",function(){return this.object});Model.add("getData",function(){return this.modelData});Model.add("getFiles",function(){return this.modelFiles});Model.add("file",function(input){var _self=this,_formData=new FormData,_files=[],_field=_$(input).get(0);return new Promise(function(resolve,reject){if(_field.type==="file"){var _temp=_field.files,x=_temp.length;while(x--){_files[x]=_temp[x];_formData.append(_field.name,_temp[x])}}_self.object["_files"]=_files;_self.modelFiles=_formData;resolve(_self)})});Model.add("files",function(model){var _self=this;_self.model=_$(model);return new Promise(function(resolve,reject){_self.model.find('input[type="file"]',function(field){_self.file(field.get(0)).then(resolve)})})});Model.add("pack",function(model){this.model=_$(model);var _self=this,_modelData=new FormData,_field_array,_model_obj=_self.model.get(0),_fields=_model_obj.querySelectorAll("input, textarea, select"),x=_fields.length;_self.failed=false;return new Promise(function(resolve,reject){while(x--){if(_fields[x].type==="file"||!_fields[x]){continue}if(_fields[x].type==="checkbox"||_fields[x].type==="radio"){if(!_fields[x].checked){continue}}var field=_fields[x],fieldValue=field.value;if(!_$(field).data("skip")&&_.isEmpty(fieldValue)){reject(_self.fail(field,"empty"));break}else if(_$(field).data("mail")&&!_.isMail(fieldValue)){reject(_self.fail(field,"invalid_mail"));break}else if(_$(field).data("min")&&+_$(field).data("min")>fieldValue.length){reject(_self.fail(field,"minim_chars"));break}else if(_$(field).data("max")&&+_$(field).data("max")<fieldValue.length){reject(_self.fail(field,"overflow_chars"));break}else{if(_$(field).data("custom")){var Regex=new RegExp(_$(field).data("custom"),"g");if(!Regex.test(fieldValue)){reject(_self.fail(field,"invalid_custom"));break}}if(_.isSet(field.name)){if(!!(_field_array=_self.multiple(field.name)))fieldValue=_field_array;_modelData.append(field.name,fieldValue);_self.object[field.name]=fieldValue}}}_self.modelData=_modelData;resolve(_self)})});