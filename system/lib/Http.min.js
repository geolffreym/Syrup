"use strict";function Http(){this.xhr=new window.XMLHttpRequest||new window.ActiveXObject("Microsoft.XMLHTTP");this.xhr_list=[];this.upload=null;this.before=null;this.complete=null;this.progress=null;this.state=null;this.abort=null;this.time_out=null}Http.add("on",function(event,callback){var self=this;return[{before:function(){self.before=callback},complete:function(){self.complete=callback},abort:function(){self.abort=callback},state:function(){self.state=callback},timeout:function(){self.time_out=callback},progress:function(){self.progress=callback}}[event]()]});Http.add("request",function(config){if(!_.isObject(config)){_.error(_.WARNING_SYRUP.ERROR.NOOBJECT,"(Http Request)")}var _self=this,_xhr=_self.xhr,_query=_.emptyStr,_type=(config.method||"GET").toUpperCase(),_timeout=config.timeout||4e3,_cors=config.cors||false,_token=config.token||false,_contentType=config.contentType||"application/x-www-form-urlencoded;charset=utf-8",_data=config.data||false,_contentHeader={header:"Content-Type",value:_contentType};return new Promise(function(resolve,reject){if(!_.isSet(config.url))_.error(_.WARNING_SYRUP.ERROR.NOURL,"(Http Request)");if(!_.isFormData(_data)&&_.isSet(_data)&&_contentType!=="auto"){_data=_.jsonToQueryString(_data)}if(_type==="GET"&&_.isSet(_data)){_query+="?"+_data}_query=config.url+_query;_xhr.open(_type,_query,true);_xhr.timeout=_timeout;if(!_.isFormData(_data)&&_contentType!=="auto"){_self.requestHeader(_contentHeader.header,_contentHeader.value)}if(_.isSet(_cors))_xhr.withCredentials=true;if(_.isSet(_token))_self.requestHeader("X-CSRFToken",_token);if(_.isSet(config.upload)&&_.isBoolean(config.upload)){_self.upload=_self.xhr.upload;_xhr=_self.upload}_xhr.addEventListener("load",function(e){if(this.status>=200&&this.status<400){var _response=this.response||this.responseText;if(_.isJson(_response)){_response=JSON.parse(_response)}resolve(_response)}});_xhr.addEventListener("progress",function(e){if(_self.progress){_self.progress(e)}},false);_xhr.addEventListener("readystatechange",function(e){if(this.readyState){if(_self.state){_self.state(this.readyState,e)}}});_xhr.addEventListener("abort",function(e){if(_self.abort){_self.abort(e)}});_xhr.addEventListener("timeout",function(e){if(_self.time_out){_self.time_out(e)}});_xhr.addEventListener("loadend",function(e){if(_self.complete){_self.complete(e)}});_xhr.addEventListener("loadstart",function(e){if(_self.before){_self.before(e)}});_xhr.addEventListener("error",function(e){reject(e)});_self.xhr_list.push(_self.xhr);_xhr.send(_type!=="GET"?_data:null)})});Http.add("get",function(url,data){var _conf={url:url,data:data};this.kill();return this.request(_conf)});Http.add("post",function(url,data){var _conf={method:"POST",url:url,data:data};this.kill();return this.request(_conf)});Http.add("put",function(url,data){var _conf={method:"PUT",url:url,data:data};this.kill();return this.request(_conf)});Http.add("delete",function(url,data){var _conf={method:"DELETE",url:url,data:data};this.kill();return this.request(_conf)});Http.add("requestHeader",function(header,type){this.xhr.setRequestHeader(header,type);return this});Http.add("kill",function(){_.each(this.xhr_list,function(xhr){xhr.abort()});this.xhr_list.length=0;return this});