"use strict";function Router(){this.routes={};this.history=window.history;this.findParams=/(:[\w]+)/g;this.onpopstate={};var _self=this;window.addEventListener("popstate",function(e){if(_.isSet(e.state)&&"route_name"in e.state){if(e.state.route_name in _self.onpopstate){_self.onpopstate[e.state.route_name].forEach(function(v,i){v(e.state,e)})}}})}Router.add("setRoutes",function(routes){var _self=this;return new Promise(function(resolve,reject){_self.routes=_.extend(_self.routes,routes);resolve(_self.routes)})});Router.add("when",function(route_name){_.assert(route_name,_.WARNING_SYRUP.ERROR.NOPARAM,"(Router .when)");var _self=this;return{then:function(callback){if(_.isFunction(callback)){if(!(route_name in _self.onpopstate))_self.onpopstate[route_name]=[];_self.onpopstate[route_name].push(callback)}}}});Router.add("redirect",function(route_name,params,config){_.assert(route_name,_.WARNING_SYRUP.ERROR.NOPARAM,"(Router .redirect)");var _self=this,_the_new_route=null,_params=null,_config={trigger:true};return new Promise(function(resolve,reject){if(!(route_name in _self.routes)){reject(route_name);return}_params=_.isObject(params)?params:{};_config=_.extend(_config,config||{},true);_params["route_name"]=route_name;_the_new_route=_self.routes[route_name];_the_new_route=_.isSet(params)&&_.getObjectSize(params)>0?_.replace(_the_new_route,_self.findParams,params):_the_new_route;_self._triggerPopState(_params,route_name,_the_new_route,_config);resolve(_the_new_route)})});Router.add("_triggerPopState",function(_params,route_name,_the_new_route,_config){if(_config.trigger){this.history.pushState(_params,route_name,_the_new_route);this.history.pushState(_params,route_name,_the_new_route);this.history.back()}});